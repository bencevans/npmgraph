<html>
<head>
  <title>{{package.name}} | npm graph</title>
  <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.min.js"></script>
  <style type="text/css">
  body {
    background-color: #A7342F;
    font-family: Verdana;
    color: #222;
  }

  .container {
    background-color: #FFF;
    width: 720px;
    margin: auto;
    padding: 10px;
  }

  .graph-container {
    background-color: #111;
  }

  svg {
    height: 150px;
    padding: 5px;
  }

  svg rect {
    fill:#ccc;
  }
  </style>
</head>
<body>
  <div class="container">
    <h2>{{package.name}}</h2> <a href="https://npmjs.org/package/{{package.name}}">view on npm</a>
    <div class="graph-container">
      <svg/>
    </div>
  </div>
  <script type="text/javascript">

  var NS = "http://www.w3.org/2000/svg";
  function chart(svgDOM, data) {
    var width = 710;
    var height = 150;
    var barGutter = 1;
    var barWidth = width / data.length
    var max = null;
    for(var i in data) {
      if(max == null || max < data[i].downloads)
        max = data[i].downloads;
    }
    for(var i in data) {
      var SVGObj=document.createElementNS(NS,"rect");
      SVGObj.setAttribute("height", ((data[i].downloads == 0) ? 0 : Math.round((data[i].downloads/max) * height)));
      SVGObj.setAttribute("width", barWidth - barGutter);
      SVGObj.setAttribute("y", height - ((data[i].downloads == 0) ? 0 : Math.round((data[i].downloads/max) * height)));
      SVGObj.setAttribute("x", i * barWidth);
      var title = document.createElementNS(NS, "title");
      title.textContent = data[i].date + ': ' + data[i].downloads;
      SVGObj.appendChild(title);
      svgDOM.appendChild(SVGObj);
    }
  };

  $.getJSON('/package/{{package.name}}/30days.json', function(data) {
    chart(document.querySelector('svg'), data);
  });

  </script>
</body>
</html>